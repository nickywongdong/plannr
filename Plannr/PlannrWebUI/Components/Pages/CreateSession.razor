@page "/create-session"

@inject HttpClient HttpClient
@inject ILogger<CreateSession> Logger

@using System.Text.Json

<h1>Generate a Session Link</h1>

<button @onclick="RequestSessionLink">Create Session</button>
@if (sessionLink is not null)
{
    <p>@sessionLink.UniqueLink</p>
}

@code {
    private UniqueSession? sessionLink = null;

    private async Task RequestSessionLink()
    {
        var apiUrl = "https://localhost:7018/api/uniquesessions";

        Logger.LogInformation("Requesting Session Link at {apiUrl}", apiUrl);
        var response = await HttpClient.PostAsync(apiUrl, null);

        if (response.IsSuccessStatusCode)
        {
            var responseStream = await response.Content.ReadAsStreamAsync();
            sessionLink = await JsonSerializer.DeserializeAsync<UniqueSession>(responseStream);
            Logger.LogInformation("Created unique session with id: {id}", sessionLink?.Id.ToString());
        }
        else
        {
            var statusCode = response.StatusCode;
            Logger.LogError("Non Successful Result: {statusCode}", statusCode);
        }
    }

}
